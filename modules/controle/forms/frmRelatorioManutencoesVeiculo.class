
<?php
/* Copyright 2006, 2007, 2008, 2009, 2010 do SETEC/MEC
 *
 * Este arquivo é parte do programa SigaEPT
 *
 * O SigaEPT é um software livre;  você pode redistribuí-lo e/ou modificá-lo dentro dos
 * termos da Licença Pública Geral GNU como publicada pela fundação do software livre (FSF);
 * na versão 2 da Licença.
 *
 * Este programa é distribuído na esperança que possa ser útil, mas SEM NENHUMA GARANTIA; sem
 * uma garantia implícita de ADEQUAÇÃO a qualquer MERCADO ou APLICAÇÃO EM PARTICULAR. Veja Licença
 * Pública Geral GNU/GPL em português para maiores detalhes.
 *
 * Você deve ter recebido uma cópia da Licença Pública Geral GNU, sob o título “LICENCA.txt”,
 * junto com este programa, se não, acesse o portal do Software Público Brasileiro no endereço
 * www.softwarepublico.gov.br ou escreva para Fundação do Software Livre (FSF) Inc.,51 Franklin
 * St, Fifth Floor, Boston, MA 02110-1301, USA
 */
?>

<?
class frmRelatorioManutencoesVeiculo extends Form
{
	function frmRelatorioManutencoesVeiculo()
    {
		global $MIOLO, $action, $module, $item;
			    
		$this->Form("Manutenções");
		$this->EventHandler();
  		$this->defaultButton = false;
		$this->SetClose($this->manager->GetActionURL($module, 'main:relatorios'));  		
	}

	function CreateFields()
	{
		global $MIOLO, $action, $module, $item, $page;

		$meses = array(
			"JANEIRO-01"=>"JANEIRO",
			"FEVEREIRO-02"=>"FEVEREIRO",
			"MARCO-03"=>"MARCO",
			"ABRIL-04"=>"ABRIL",
			"MAIO-05"=>"MAIO",
			"JUNHO-06"=>"JUNHO",
			"JULHO-07"=>"JULHO",
			"AGOSTO-08"=>"AGOSTO",
			"SETEMBRO-09"=>"SETEMBRO",
			"OUTUBRO-10"=>"OUTUBRO",
			"NOVEMBRO-11"=>"NOVEMBRO",
			"DEZEMBRO-12"=>"DEZEMBRO"
				);
		$opcoes = array(
			"0"=>"ANUAL",
			"1"=>"MENSAL",
			"2"=>"TOTAL");

		$fields = Array (
			new MSelection('op','','Opção',$opcoes),
			new LookupTextField('lkpVeiculo','','Veiculo','20'),
			new MHiddenField('placa'),
			new MSelection('mes','','Mes',$meses),
			new MTextField('ano','','Ano',4)
				);
		
		$this->SetFields($fields);

		$buttons = Array(			
			new FormButton('btnRelatorio', 'Gerar Relatório', 'PDF'),
			new MButton('btnEnviar','Enviar'),
			new MButton('btnEnviar2','Enviar'),
			
   		    );
		$this->SetButtons($buttons);
			
		$this->SetButtonAttr('btnRelatorio','visible',false);
		$this->SetButtonAttr('btnEnviar2','visible',false);
				
		$this->SetFieldAttr('lkpVeiculo','module','adm');
		$this->SetFieldAttr('lkpVeiculo','item','veiculo');
		$this->SetFieldAttr('lkpVeiculo','event','filler');
		$this->SetFieldAttr('lkpVeiculo','related','null,placa,null,lkpVeiculo');			
		
		$this->SetFieldAttr('lkpVeiculo','visible',false);
		$this->SetFieldAttr('mes','visible',false);
		$this->SetFieldAttr('ano','visible',false);
	}	
	function btnEnviar_click()
	{
		$op = $this->GetFormValue('op');
		$this->SetFieldAttr('op','readonly',true);
		$this->SetButtonAttr('btnEnviar','visible',false);
		switch($op)
		{
			//Relatório Anual
			case "0": 
				$this->SetFieldAttr('ano','visible',true);
				$this->SetButtonAttr('btnRelatorio','visible',true);
			break;
			//Relatório Mensal
			case "1":
				$ano = date("Y");
				$this->SetFieldAttr('mes','visible',true);
				$this->SetFieldAttr('ano','visible',true);
				$this->SetFieldValue('ano',$ano);
				$this->SetFieldAttr('ano','readonly',true);
				//$this->SetButtonAttr('btnRelatorio2','visible',true);
				$this->SetButtonAttr('btnRelatorio','visible',true);
			break;
			//Relatório Total 
			case "2":
				$this->SetButtonAttr('btnRelatorio','visible',true);
			break;
			case null:
				$msg = "Favor, escolha uma opção";
				$this->manager->Information($msg,$this->manager->GetActionURL('controle','main:relmanutencaoveiculo'));
			break;
		}
		
	}
	function btnRelatorio_click()
	{
		global $MIOLO,$module;
		
		$data = $this->getData();
		$ui = $MIOLO->GetUI();
	  	$report = $ui->GetReport($module,'repManutencoesVeiculo',$data);
    	$report->Generate();		 
       
	}
	function btnRelatorio2_click()
	{
		global $MIOLO,$module;
		
		$data = $this->getData();
		$ui = $MIOLO->GetUI();
	  	$report = $ui->GetReport($module,'repManutencoesVeiculo',$data);
    	$report->Generate();
	}
	
}
?>
