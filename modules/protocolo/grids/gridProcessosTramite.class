
<?php
/* Copyright 2006, 2007, 2008, 2009, 2010 do SETEC/MEC
 *
 * Este arquivo é parte do programa SigaEPT
 *
 * O SigaEPT é um software livre;  você pode redistribuí-lo e/ou modificá-lo dentro dos
 * termos da Licença Pública Geral GNU como publicada pela fundação do software livre (FSF);
 * na versão 2 da Licença.
 *
 * Este programa é distribuído na esperança que possa ser útil, mas SEM NENHUMA GARANTIA; sem
 * uma garantia implícita de ADEQUAÇÃO a qualquer MERCADO ou APLICAÇÃO EM PARTICULAR. Veja Licença
 * Pública Geral GNU/GPL em português para maiores detalhes.
 *
 * Você deve ter recebido uma cópia da Licença Pública Geral GNU, sob o título “LICENCA.txt”,
 * junto com este programa, se não, acesse o portal do Software Público Brasileiro no endereço
 * www.softwarepublico.gov.br ou escreva para Fundação do Software Livre (FSF) Inc.,51 Franklin
 * St, Fifth Floor, Boston, MA 02110-1301, USA
 */
?>

<?
class gridProcessosTramite extends MObjectGrid
{

    function __construct($objProcesso)
    {
//      construct
        global $MIOLO, $module, $self, $page;
		$processo = $objProcesso;
		$action = $MIOLO->GetActionURL($module,$self,$processo->numProcesso,array('form'=>'tramite','subform'=>'despacho','numAndamento'=>'#0#'));
        $href_grid = $MIOLO->GetActionURL($module,$self);
//      format data
        $processo->formataGridProcessosTramite();   
//		instância objeto usuario
		$user = $MIOLO->GetBusiness('common','usuario');
//      grid
       $columns = array(
            new MObjectGridColumn('numAndamento','Trâmite','center', false,'8%',true),
            new MObjectGridColumn('status','Situação','center',false,'10%',true,array('N'=>'NORMAL','J'=>'ANEXADO','A'=>'ARQUIVADO')),
            new MObjectGridColumn('setorData','Setor - Entrada','center', false,'23%',true),
            new MObjectGridColumn('setorDestinoData','Setor - Saída','center', false,'23%',true),            
			new MObjectGridColumn('decisaoData','Despacho','center', false,'16%',true),
			new MObjectGridColumn('autor','Autor','center', false,'20%',true)
           );         
             
            
           foreach ($processo->andamento as $proc)
            {
				if($proc->idUsuario!=NULL)
				{
					$proc->nomeUsuario = $user->GetById($proc->idUsuario)->GetName();
				}

            	if ( !(trim($proc->decisao) == NULL ) || !(trim($proc->autor) == NULL) ) 
            	{   
            		$action = $MIOLO->GetActionURL($module,$self,$processo->numProcesso,array('form'=>'tramite','subform'=>'despacho','numAndamento'=>$proc->numAndamento));
            		$proc->decisaoData = "<a href='$action'>$proc->decisaoData</a>";       			
            	} 
            }
              
        $this->SetTitle(NULL);
        $this->SetFilter(false);
        $this->SetIndex(1);
        parent::__construct($processo->andamento,$columns, $href_grid,25);
        $controls = array(
            new MButton('btnReport','Imprimir','pdf'),
        );
        $this->setControls($controls);
        $this->SetWidth('100%');
        $this->SetLinkType('hyperlink');
        
    }
    function GenerateHeader()
    {
        return NULL;
    }
    function GenerateFooter()
    {
//      footer
        if (!$this->data) $footer[] = $this->GenerateEmptyMsg();
        $footer[] = new Separator();
        $footer[] = $this->GenerateControls();
        return $footer;
    }
}
?>
