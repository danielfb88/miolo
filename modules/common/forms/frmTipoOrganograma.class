
<?php
/* Copyright 2006, 2007, 2008, 2009, 2010 do SETEC/MEC
 *
 * Este arquivo é parte do programa SigaEPT
 *
 * O SigaEPT é um software livre;  você pode redistribuí-lo e/ou modificá-lo dentro dos
 * termos da Licença Pública Geral GNU como publicada pela fundação do software livre (FSF);
 * na versão 2 da Licença.
 *
 * Este programa é distribuído na esperança que possa ser útil, mas SEM NENHUMA GARANTIA; sem
 * uma garantia implícita de ADEQUAÇÃO a qualquer MERCADO ou APLICAÇÃO EM PARTICULAR. Veja Licença
 * Pública Geral GNU/GPL em português para maiores detalhes.
 *
 * Você deve ter recebido uma cópia da Licença Pública Geral GNU, sob o título “LICENCA.txt”,
 * junto com este programa, se não, acesse o portal do Software Público Brasileiro no endereço
 * www.softwarepublico.gov.br ou escreva para Fundação do Software Livre (FSF) Inc.,51 Franklin
 * St, Fifth Floor, Boston, MA 02110-1301, USA
 */
?>

<?
class frmTipoOrganograma extends MForm
{
	function __construct()
    {   
        parent::__construct('Tipo Organograma');
        $this->SetWidth('50%');
	    $this->EventHandler();
	}

    function CreateFields()
	{
       $fields = Array(
		   new MHiddenField('key',''),
           array(
    		   new MTextField('idTipoOrganograma','','IdTipoOrganograma',4),
               new MText('acao','','blue'),
               new MCheckBox('ativo','ativo','&nbsp;',true,'Somente setores ativos'),
           ),
           array(
              new MLookupTextField('sigla','','Sigla',15),
              new MTextField('descricao','','Descrição',35),
           ),
       );
	   $this->SetFields($fields);
       $this->SetFieldValue('acao','[seleção]');
	   $this->SetFieldAttr('sigla','module','common');
	   $this->SetFieldAttr('sigla','item','tipoorganograma');
	   $this->SetFieldAttr('sigla','event','btnFind:click');

       $buttons = Array(
           new MButton('btnFind', 'Consultar'),
       );
	   $this->SetButtons($buttons);
       $this->SetFieldAttr('btnFind','visible',true); 
	}

	function btnFind_click($sender, $item=NULL)
	{   
	    $action = $this->manager->GetCurrentURL();
        $item = ($item != NULL ? $item : $this->GetFieldValue('idTipoOrganograma'));
        if ($item != NULL)
        {
            $tipoOrganograma = $this->manager->GetBusiness('common','tipoorganograma', $item);
            $this->SetFieldValue('idTipoOrganograma', $tipoOrganograma->idTipoOrganograma); 
            $this->SetFieldValue('sigla', $tipoOrganograma->sigla); 
            $this->SetFieldValue('descricao', $tipoOrganograma->descricao); 
            $ativo = $this->ativo->checked;
            $organograma = $tipoOrganograma->GetOrganograma($ativo); 
            array_unshift($organograma, array('root',0,'',''));
			$action = $this->manager->GetActionURL('common','admin:setor','#',array('event'=>'btnEdit:click'));
            $tree = new MTreeMenu('tree',0, $action,'_self');
            $tree->SetItemsFromArray($organograma,'0','1,3,2');
            $this->AddField($tree);        
        }
	}
}
?>
