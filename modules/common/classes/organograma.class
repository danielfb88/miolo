
<?php
/* Copyright 2006, 2007, 2008, 2009, 2010 do SETEC/MEC
 *
 * Este arquivo é parte do programa SigaEPT
 *
 * O SigaEPT é um software livre;  você pode redistribuí-lo e/ou modificá-lo dentro dos
 * termos da Licença Pública Geral GNU como publicada pela fundação do software livre (FSF);
 * na versão 2 da Licença.
 *
 * Este programa é distribuído na esperança que possa ser útil, mas SEM NENHUMA GARANTIA; sem
 * uma garantia implícita de ADEQUAÇÃO a qualquer MERCADO ou APLICAÇÃO EM PARTICULAR. Veja Licença
 * Pública Geral GNU/GPL em português para maiores detalhes.
 *
 * Você deve ter recebido uma cópia da Licença Pública Geral GNU, sob o título “LICENCA.txt”,
 * junto com este programa, se não, acesse o portal do Software Público Brasileiro no endereço
 * www.softwarepublico.gov.br ou escreva para Fundação do Software Livre (FSF) Inc.,51 Franklin
 * St, Fifth Floor, Boston, MA 02110-1301, USA
 */
?>

<?php
/**
 * Brief Class Description.
 * Complete Class Description.
 * 
 * @author UFJF-CGCO
 * @access public
 *
 */
class BusinessCommonOrganograma extends MBusiness
{
    var $idTipoOrganograma;
    var $idSetor;
    var $idSetorPai;
    var $tipoOrganograma;
    var $setor;
    var $setorPai; 
	
    /**
	 * Constructor
	 *
	 * BusinessCommonOrganograma Class Constructor 
	 * @param $data (tipo) desc
	 */
    function __construct($data=null)
    {
       parent::__construct('common',$data);
    }
	
    
    /**
	 * Método utilizado para setar os atributos do objeto.
	 *
	 * @name setData
	 * @param $data (tipo) parametro que contem os dados do objeto.
	 * @return void
	 * @access public
	 */
	function setData($data)
	{
		$this->idTipoOrganograma = $data->idTipoOrganograma;
		$this->idSetor           = $data->idSetor;
		$this->idSetorPai        = $data->idSetorPai;
	}
	
	
	/**
	 * Método que busca um organograma no banco com o id passado e o retorna.
	 *
	 * @name getById
	 * @param $id (tipo) id do organograma para buscar no banco. 
	 * @return (object) Retorna uma um objeto da própria classe.
	 * @access public
	 */
    function getById($idTipoOrganograma, $idSetor)
    {
       $this->idTipoOrganograma = $idTipoOrganograma;
       $this->idSetor           = $idSetor;
       $this->retrieve();
       return $this;
    }
	
    
    /**
	 * Método que lista organogramas de determinado tipo.
	 *
	 * @name listByIdTipo
	 * @param $id (tipo) id do tipo de organograma para buscar no banco. 
	 * @return (tipo) Retorna uma lista com os resultados que vieram do banco.
	 * @access public
	 */
    function listByIdTipo($idTipoOrganograma)
    {
        $criteria = $this->getCriteria();
        $criteria->addCriteria('idTipoOrganograma','=',$idTipoOrganograma);//$criteria->addCriteria('idTipoOrganograma','=',"'$idTipoOrganograma%'");
        $query = $criteria->retrieveAsQuery();$criteria->addCriteria('idTipoOrganograma','=',"'$idTipoOrganograma%'");
        return $query;
    }

    
    /**
	 * Método que lista organogramas de determinado tipo.
	 *
	 * @name listByTipo
	 * @param $tipoOrganograma (tipo) tipo de organograma para buscar no banco. 
	 * @return (tipo) Retorna uma lista com os resultados que vieram do banco.
	 * @access public
	 */
    function listByTipo($tipoOrganograma)
    {
        $criteria = $this->getCriteria();
        $criteria->addCriteria('tipoorganograma.tipoOrganograma','=',"'$tipoOrganograma%'");
        $query = $criteria->retrieveAsQuery();
        return $query;
    }
	
    
    /**
	 * Método que lista organogramas de determinado setor.
	 *
	 * @name listByIdSetor
	 * @param $isSetor (tipo) id do setor para buscar no banco. 
	 * @return (tipo) Retorna uma lista com os resultados que vieram do banco.
	 * @access public
	 */
    function listByIdSetor($idSetor)
    {
        $criteria = $this->getCriteria();
        $criteria->addColumnAttribute('idTipoOrganograma');
        $criteria->addColumnAttribute('setorPai.sigla');
        $criteria->addColumnAttribute('setorPai.idSetor');
        $criteria->addCriteria('idSetor','=',$idSetor);
        $query = $criteria->retrieveAsQuery();
        return $query;
    }
	
    
    /**
	 * Método que deleta organogramas de determinado setor.
	 *
	 * @name deleteByIdSetor
	 * @param $isSetor (tipo) id do setor para buscar no banco. 
	 * @return void
	 * @access public
	 */
    function deleteByIdSetor($idSetor)
    {
        $criteria = $this->getDeleteCriteria();
        $criteria->addCriteria('idSetor','=',$idSetor);
        $criteria->delete();
    }
    
    
    /**
	 * Método que lista organogramas que o pai pertence a determinado setor.
	 *
	 * @name listByIdSetorPai
	 * @param $isSetor (tipo) id do setor do pai para buscar no banco. 
	 * @return (tipo) Retorna uma lista com os resultados que vieram do banco.
	 * @access public
	 */
    function listByIdSetorPai($idSetorPai)
    {
        $criteria = $this->getCriteria();
        $criteria->addColumnAttribute('idSetor');
        $criteria->addCriteria('setorPai.idSetor','=',$idSetorPai);
        $query = $criteria->retrieveAsQuery();
        return $query;
    }
    
    
    /**
	 * Brief Description
	 * Complete Description
	 *
	 * @name listByOrg
	 * @param $isSetor (tipo) id do setor para buscar no banco. 
	 * @return void
	 * @access public
	 */
    function listByOrg($idSetor)
    {
    	
    	$arrSetores = $this->listByIdSetorPai($idSetor);
    	//var_dump($arrSetores->result);
    	if ( is_array($arrSetores->result) ) 
	    	foreach ($arrSetores->result as $setor)
	    	{
	    		//var_dump($setor[0]);
	    		$this->listByOrg($setor[0]);
	    	}
    }
    
    function findByNome($nome)
    {
		$busca = "select count(*) as total from cm_tipoorganograma where sigla = '$nome'";					
		return pg_fetch_result( pg_query($busca) ,0, 'total' );
    }

}
?>
