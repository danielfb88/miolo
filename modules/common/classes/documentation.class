
<?php
/* Copyright 2006, 2007, 2008, 2009, 2010 do SETEC/MEC
 *
 * Este arquivo é parte do programa SigaEPT
 *
 * O SigaEPT é um software livre;  você pode redistribuí-lo e/ou modificá-lo dentro dos
 * termos da Licença Pública Geral GNU como publicada pela fundação do software livre (FSF);
 * na versão 2 da Licença.
 *
 * Este programa é distribuído na esperança que possa ser útil, mas SEM NENHUMA GARANTIA; sem
 * uma garantia implícita de ADEQUAÇÃO a qualquer MERCADO ou APLICAÇÃO EM PARTICULAR. Veja Licença
 * Pública Geral GNU/GPL em português para maiores detalhes.
 *
 * Você deve ter recebido uma cópia da Licença Pública Geral GNU, sob o título “LICENCA.txt”,
 * junto com este programa, se não, acesse o portal do Software Público Brasileiro no endereço
 * www.softwarepublico.gov.br ou escreva para Fundação do Software Livre (FSF) Inc.,51 Franklin
 * St, Fifth Floor, Boston, MA 02110-1301, USA
 */
?>

<?

class BusinessCommonDocumentation extends Business
{
    function GetDatabase()
    {   global $MIOLO;
        return $MIOLO->GetDatabase('common');
    }
    
    function ClearAll()
    {
        $db = $this->GetDatabase();
        $db->Execute("delete from cmn_functions");
        $db->Execute("delete from cmn_classes");
        $db->Execute("delete from cmn_sources");
        $db->Close();
    }
    
    function RegisterSource($path)
    {   global $MIOLOCONF;
        $home = $MIOLOCONF['home']['html'];
        if ( strpos($path,$home) === 0 )
        {
            $path = substr($path,strlen($home)+1);
        }
        $db = $this->GetDatabase();
        $rs = $db->Query("select id from cmn_sources where path='$path'");
        $id = $rs[0][0];
        if ( $id )
        {
            $db->Execute("delete from cmn_classes where ref_source=$id");
            $db->Execute("delete from cmn_functions where ref_source=$id");
        }
        else
        {
            $rs = $db->Query("select max(id) from cmn_sources");
            $id = $rs[0][0] + 1;
            $db->Execute("insert into cmn_sources (id,path) values ($id,'$path')");
        }
        $db->Close();
        return $id;
    }
    
    function RegisterClass($ref_source,$name)
    {
        $db = $this->GetDatabase();
        $rs = $db->Query("select max(id) from cmn_classes");
        $id = $rs[0][0] + 1;
        $db->Execute("insert into cmn_classes (id,ref_source,name) values ($id,$ref_source,'$name')");
        $db->Close();
        return $id;
    }
    
    function RegisterFunction($ref_source,$ref_class,$name)
    {
        $db = $this->GetDatabase();
        $rs = $db->Query("select max(id) from cmn_functions");
        $id = $rs[0][0] + 1;
        $db->Execute("insert into cmn_functions (id,ref_source,ref_class,name) values ($id,$ref_source,$ref_class,'$name')");
        $db->Close();
        return $id;
    }
    
    function QueryFunctionList()
    {
        $sql = "select S.path, C.name, F.name from cmn_sources S, cmn_classes C, cmn_functions F" .
               "  where F.ref_source=S.id and F.ref_class=C.id order by F.name, C.name";
        $db = $this->GetDatabase();
        $rs = $db->Query($sql);
        $db->Close();
        return $rs;
    }
    function listModules()
    {
        $query->result = array(
                array("ADM","Administrativo"),
                array("ENS","Ensino")
                );
        return $query;
    }

    function listGroupByModule($module)
    {
        if ( $module == "ADM" )
        {
            $grupo = $this->_miolo->getBusinessMAD('group');
            $criteria = $grupo->getCriteria();
            $criteria->addColumnAttribute('idGrupo');
            $criteria->addColumnAttribute('grupo');
            $criteria->addCriteria('grupo','like',"'$module%'");
            $query = $criteria->retrieveAsQuery();
            return $query->result;
        }
        else
        {
            $result = array(
                array("40","ALUNO"),
                array("846","ALUNO_CTU"),
                array("100","APOIOALUNO"),
                array("420","CADASTROALUNO"),
                array("160","CDARA"),
                array("1431","CDARA_RETIFICACAO"),
                array("140","CONSULTAALUNO"),
                array("528","COORD_PREMATRICULA"),
                array("530","COORDUNI"),
                array("60","CURRICULO"),
                array("523","DARA_SENHA"),
                array("766","DOCENTES_ASSOCIADOS"),
                array("380","J23_ALUNO"),
                array("666","J23_COORD"),
                array("400","J23_DOCENTE"),
                array("443","J23_MATRICULA"),
                array("440","SECPROREITORIA"),
                array("1349","SIGA_APOSENTADO"),
                array("554","SIGA_ATUALIZAALUNO"),
                array("1229","SIGA_AUXPROGRAD"),
                array("926","SIGA_CENTRALATEND"),
                array("121","SIGA_CHEFEDEPTO"),
                array("240","SIGA_CONSULTA"),
                array("1109","SIGA_CONSULTACONVENIO"),
                array("80","SIGA_COORDCURSO"),
                array("200","SIGA_COORDCURSO2"),
                array("360","SIGA_COORDPGSTRICTU"),
                array("280","SIGA_COORDPOS"),
                array("20","SIGA_DARA"),
                array("1250","SIGA_DARAPLANODEP"),
                array("906","SIGA_DARA2"),
                array("907","SIGA_DARA3"),
                array("946","SIGA_DARA4"),
                array("643","SIGA_DIPLOMA"),
                array("120","SIGA_DOCENTE"),
                array("886","SIGA_ESCOLAPUBLICA"),
                array("786","SIGA_FORMANDO"),
                array("441","SIGA_FUNC_DARA"),
                array("482","SIGA_GERENCIAL"),
                array("726","SIGA_IMPRIMEHE"),
                array("1169","SIGA_INCLUSAONOTAHISTORICO"),
                array("320","SIGA_J23"),
                array("867","SIGA_MATRICULA"),
                array("1129","SIGA_MATRICULACDARA"),
                array("990","SIGA_MONITOR"),
                array("639","SIGA_MONITORIA"),
                array("991","SIGA_MON_ORIENTADOR"),
                array("746","SIGA_NOTASPORTURMA"),
                array("806","SIGA_PGLATOSENSU"),
                array("807","SIGA_PGSTRICTO"),
                array("7","SIGA_PLANODEP"),
                array("180","SIGA_PROREITORIA"),
                array("522","SIGA_PROREITORIAPOS"),
                array("550","SIGA_RELATORIOS"),
                array("826","SIGA_RETIFICACAONOTA"),
                array("260","SIGA_SECRETARIO"),
                    );
            return $result;
        }


    }
}
?>
