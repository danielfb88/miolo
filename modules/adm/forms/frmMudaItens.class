
<?php
/* Copyright 2006, 2007, 2008, 2009, 2010 do SETEC/MEC
 *
 * Este arquivo é parte do programa SigaEPT
 *
 * O SigaEPT é um software livre;  você pode redistribuí-lo e/ou modificá-lo dentro dos
 * termos da Licença Pública Geral GNU como publicada pela fundação do software livre (FSF);
 * na versão 2 da Licença.
 *
 * Este programa é distribuído na esperança que possa ser útil, mas SEM NENHUMA GARANTIA; sem
 * uma garantia implícita de ADEQUAÇÃO a qualquer MERCADO ou APLICAÇÃO EM PARTICULAR. Veja Licença
 * Pública Geral GNU/GPL em português para maiores detalhes.
 *
 * Você deve ter recebido uma cópia da Licença Pública Geral GNU, sob o título “LICENCA.txt”,
 * junto com este programa, se não, acesse o portal do Software Público Brasileiro no endereço
 * www.softwarepublico.gov.br ou escreva para Fundação do Software Livre (FSF) Inc.,51 Franklin
 * St, Fifth Floor, Boston, MA 02110-1301, USA
 */
?>

<?
/*
  Gevã Schaefer Pereira Martins - Início: 07/10/04 Término: 18/10/04
*/
class frmMudaItens extends Form
{
   var $objItem;
   var $entregador='ooooba oba! oba!';
      
   function __construct()
   {
 	  global $MIOLO, $module, $self;
  	  $this->listURL = $MIOLO->GetActionURL($module,$self,'',Array('event'=>'btnList:click') );
 	  $this->objItem = $MIOLO->GetBusiness('adm','item');
 	  $this->Form('Item');
 	  $this->EventHandler();
   }

   function CreateFields()
   {
      global $MIOLO,$module,$self, $action, $auth,$item;

	  $this->objPtr = $MIOLO->GetBusiness('adm','ptr');
	  $this->objFonte = $MIOLO->GetBusiness('adm','fonte');
	  $this->objRubrica = $MIOLO->GetBusiness('adm','rubrica');
	  $objItem = $MIOLO->GetBusiness($module,'item');
	  $fields = array
      (
	     new TextField('descricao','','Id do Item',30),
         new Selection('selPtr','','Ptr','',false),
		 new Selection('selFonte','','Fonte','',false),
		 new Selection('selRubrica','','Rubrica','',false),
		 new HiddenField('hidId','')
      );
	  $this->SetFields($fields);
	  $this->SetFieldAttr('hidId','value',$item);

      $objQuery = $this->objPtr->ListAll();
	  $this->SetFieldAttr('selPtr','options', $objQuery->result);

	  $objQuery = $this->objFonte->ListAll();
	  $this->SetFieldAttr('selFonte','options', $objQuery->result);
	  $objQuery = $this->objRubrica->ListAll();
	  $this->SetFieldAttr('selRubrica','options', $objQuery->result);
	  $vetor = explode('_',$item);
	  $this->SetFieldAttr('descricao','value', $vetor[1]);


      $this->SetFieldAttr('descricao','readonly',true);
	  $buttons = array
      (
	     new FormButton('btnPost', 'Enviar'),
         new FormButton('btnVoltar','Voltar',$MIOLO->GetActionURL($module,'ordenadordespesa'))
	  );
      $this->SetButtons($buttons);
   }

   function GetData()
	{
       $data = new FormData();
	   $data->idptr = $this->GetFieldValue('selPtr');
	   $data->idfonte = $this->GetFieldValue('selFonte');
	   $data->idrubrica = $this->GetFieldValue('selRubrica');
	   $data->hidId = $this->GetFieldValue('hidId');
       return $data;
	}

   function btnPost_click()
   {
	 global $MIOLO, $module, $self, $action, $item;

	 $objItem = $MIOLO->GetBusiness($module,'item');
	 $objItem->SetAdicionais($this->GetData());
	 $ok = $objItem->InsertAdicionais();
	 if ( $ok )
	 {
	    $MIOLO->Information('Mudanças efetuadas com sucesso.', $action );
		return true;
	 }
	 $this->AddError($objItem->GetErrors());
   }

   function btnTst_click()
   {
	 $a='uma coisa';
	 $b='outra coisa';
	 $c="Isso aqui mais";
	 $c.=$a;
	 $c.="mais";
	 $c.=$b;
	 print($c);
   }
}
?>
