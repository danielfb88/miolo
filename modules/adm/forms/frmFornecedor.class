
<?php
/* Copyright 2006, 2007, 2008, 2009, 2010 do SETEC/MEC
 *
 * Este arquivo é parte do programa SigaEPT
 *
 * O SigaEPT é um software livre;  você pode redistribuí-lo e/ou modificá-lo dentro dos
 * termos da Licença Pública Geral GNU como publicada pela fundação do software livre (FSF);
 * na versão 2 da Licença.
 *
 * Este programa é distribuído na esperança que possa ser útil, mas SEM NENHUMA GARANTIA; sem
 * uma garantia implícita de ADEQUAÇÃO a qualquer MERCADO ou APLICAÇÃO EM PARTICULAR. Veja Licença
 * Pública Geral GNU/GPL em português para maiores detalhes.
 *
 * Você deve ter recebido uma cópia da Licença Pública Geral GNU, sob o título “LICENCA.txt”,
 * junto com este programa, se não, acesse o portal do Software Público Brasileiro no endereço
 * www.softwarepublico.gov.br ou escreva para Fundação do Software Livre (FSF) Inc.,51 Franklin
 * St, Fifth Floor, Boston, MA 02110-1301, USA
 */
?>

<?
class frmFornecedor extends Form
{
	var $listURL;
	var $instituicao;
	var $pessoa;
	var $banco;


	function frmFornecedor()
  {   
		global $MIOLO, $module, $page, $context, $self;

    $this->listURL     = $MIOLO->GetActionURL($module,$self,'',Array('event'=>'btnList:click') );
		$this->instituicao = $MIOLO->GetBusiness('common','instituicao');
		$this->pessoa      = $MIOLO->GetBusiness('common','pessoa');
		$this->banco       = $MIOLO->GetBusiness($module,'banco');

		
		$this->Form('Fornecedor');
		$this->EventHandler();
	}

  function CreateFields()
	{  
		global $perms, $action; 

    $fields = Array
		(
	  	new HiddenField('key',''),
	  	new LookupTextField('lkpinstituicao','','Instituição',30),
	  	new HiddenField('idinstituicao',''),
			new LookupTextField('cgc','','CGC',19),
    	new TextField('contacorrente','','Contacorrente',10),
    	new LookupTextField('idpessoa','','Representante',30),
    	new Selection('idbanco','','Banco'),

			new LookupTextField('idagenc','','Agencia',30),
    );
	  
		$this->SetFields($fields);
	  
		$this->SetFieldAttr('lkpinstituicao','module','adm');
	  $this->SetFieldAttr('lkpinstituicao','item','instituicao');
	  $this->SetFieldAttr('lkpinstituicao','event','filler');
	  $this->SetFieldAttr('lkpinstituicao','related','idinstituicao,lkpinstituicao,cgc');
    
		$objQuery = $this->banco->ListAll();
	  $this->SetFieldAttr('idbanco','options', $objQuery->Result);
	  

 
    $buttons = Array(
    	new FormButton('btnPost', 'Enviar'),
	   	new FormButton('btnNew', 'Novo', $action),
      new FormButton('btnDelete', 'Excluir'),
	   	new FormButton('btnList', 'Relação', $this->listURL)
    );
		
	  $this->SetButtons($buttons);

	  // verificar necessidade
		$this->AddValidator(new RequiredValidator('fornecedor'));
	  $this->SetButtonAttr('btnNew','visible',$perms->CheckAccess('fornecedor',A_EXECUTE));
	  $this->SetButtonAttr('btnDelete','visible',$perms->CheckAccess('fornecedor',A_EXECUTE));
	  $this->SetButtonAttr('btnPost','visible',$perms->CheckAccess('fornecedor',A_EXECUTE));

	}

	function SetData($data)
	{
		$this->SetFieldValue('key', $data->idfornecedor);
		$this->SetFieldValue('idinstituicao', $data->idinstituicao);
		$this->SetFieldValue('cgc', $data->cgc);
		$this->SetFieldValue('contacorrente', $data->contacorrente);
		$this->SetFieldValue('idpessoa', $data->idpessoa);
		$this->SetFieldValue('idbanco', $data->idbanco);
		$this->SetFieldValue('idagenc', $data->idagenc);
	}

	function btnPost_click()
	{
 		global $MIOLO, $module, $self;
    
		$action = $MIOLO->GetActionURL($module, $self); 
    $fornecedor = $MIOLO->GetBusiness($module,'fornecedor');

		if ( $fornecedor )
		{
    	$data = $this->GetData();
   	  $fornecedor->SetData($data);
		  $is_update = ($this->GetFieldValue('key') != '');
		  if ( $is_update )
		  {
	  		$ok = $fornecedor->Update();
		  }
	   	else
		  {
				$ok = $fornecedor->Insert();
	    }
      if ( $ok )
      {
      	$MIOLO->Information('Fornecedor atualizados com sucesso.', $this->listURL );
        return true;
      }
      $this->AddError($fornecedor->GetErrors());
	 	}
	}

	function btnList_click()
	{

	}

	function btnEdit_click($key='')
	{   

	}

	function btnInsert_click()
	{
       $this->SetData('');
	}

	function btnDelete_click()
	{   

	}

}

?>
