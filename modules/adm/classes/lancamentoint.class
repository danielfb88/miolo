
<?php
/* Copyright 2006, 2007, 2008, 2009, 2010 do SETEC/MEC
 *
 * Este arquivo é parte do programa SigaEPT
 *
 * O SigaEPT é um software livre;  você pode redistribuí-lo e/ou modificá-lo dentro dos
 * termos da Licença Pública Geral GNU como publicada pela fundação do software livre (FSF);
 * na versão 2 da Licença.
 *
 * Este programa é distribuído na esperança que possa ser útil, mas SEM NENHUMA GARANTIA; sem
 * uma garantia implícita de ADEQUAÇÃO a qualquer MERCADO ou APLICAÇÃO EM PARTICULAR. Veja Licença
 * Pública Geral GNU/GPL em português para maiores detalhes.
 *
 * Você deve ter recebido uma cópia da Licença Pública Geral GNU, sob o título “LICENCA.txt”,
 * junto com este programa, se não, acesse o portal do Software Público Brasileiro no endereço
 * www.softwarepublico.gov.br ou escreva para Fundação do Software Livre (FSF) Inc.,51 Franklin
 * St, Fifth Floor, Boston, MA 02110-1301, USA
 */
?>

<?
class BusinessAdmLancamentoInt extends Business
{
    public $idLancamentoInt;
    public $tipoLancamento;
	public $data;
	public $valor;
	public $idUoRequisitante;
	public $idUoExecutante;
    public $idRubrica;
    public $idRequisicao;
    public $obs;
    public $ano;
    public $requisicao;
    public $idUsuario;
    public $idLicitacao;
    public $item;

    public $usuario;
 
    function __construct($data = null)
    {
       parent::__construct('sigaept',$data);
    }

	function ListLancamentoInt($uo,$ano,$rubrica)
	{
		$criteria = $this->getCriteria();
		$criteria->addColumnAttribute('idRequisicao');
		$criteria->addColumnAttribute('requisicao.tipoRequisicao.descricao');
		$criteria->addColumnAttribute('valor');
		$criteria->addCriteria('idUoRequisitante','=',"$uo");
		$criteria->addCriteria('ano','=',"'$ano'");
		$criteria->addCriteria('idRubrica','=',"'$rubrica'");
		$criteria->addCriteria('tipoLancamento','=',"'5'");
		$criteria->addOrderAttribute('idRequisicao');
		return $criteria->retrieveAsQuery();
	}

	function ListRubricas($uo,$ano)
	{
		$criteria = $this->getCriteria();
		$criteria->setDistinct(true);
		$criteria->addColumnAttribute('idRubrica');
		$criteria->addCriteria('tipoLancamento','=',"'5'");
		$criteria->addCriteria('idUoRequisitante','=',"$uo");
		$criteria->addCriteria('ano','=',"'$ano'");
		$criteria->addOrderAttribute('idRubrica');
		$query = $criteria->retrieveAsQuery();
		return $query->result;
	}
	
	function getUoReqDotacaoComplementacao($ano)
	{
		$criteria = $this->getCriteria();
		$criteria->AddColumnAttribute('idUoRequisitante');
		$criteria->addCriteria('ano','=',$ano);
		$criteria->addCriteria('tipoLancamento','=','1');//DOTAÇÃO INICIAL
		$criteria->addOrCriteria('tipoLancamento','=','8');//COMPLEMENTAÇÃO DE CRÉDITO
		$criteria->addOrderAttribute('idUoRequisitante');
		return $criteria->retrieveAsQuery();
	}
	
	function getAnos()
	{
		$criteria = $this->getCriteria();
		$criteria->AddColumnAttribute('distinct(ano)','id');
		$criteria->AddColumnAttribute('ano','ano');
		return $criteria->retrieveAsQuery();		
	}
	
	function getTipoLancamentoDotacaoComplementacao($ano,$uo=null)
	{
		$criteria = $this->getCriteria();
		$criteria->AddColumnAttribute('data');
		$criteria->AddColumnAttribute('idUoRequisitante');
		$criteria->AddColumnAttribute('idRubrica');		
		$criteria->AddColumnAttribute('tipoLancamento');		
		$criteria->AddColumnAttribute('valor');		
		$criteria->AddColumnAttribute('idLancamentoInt');
		$criteria->addCriteria('ano','=',"'$ano'");
		
		if($uo)
		{
			$criteria->addCriteria('idUoRequisitante','=',$uo);
		}

		$cc = new CriteriaCondition();
		$cc->addCriteria($criteria->getCriteria('tipoLancamento','=',"'1'"));
 		$cc->addOrCriteria($criteria->getCriteria('tipoLancamento','=',"'2'"));
   		$cc->addOrCriteria($criteria->getCriteria('tipoLancamento','=',"'3'"));   
		$cc->addOrCriteria($criteria->getCriteria('tipoLancamento','=',"'8'"));
		$criteria->addCriteria($cc);
		
		$criteria->addOrderAttribute('data');
		return $criteria->retrieveAsQuery();
	}	
	
	function getValorDotacaoComplementacao($ano)
	{
		$criteria = $this->getCriteria();
		$criteria->AddColumnAttribute('valor');
		$criteria->addCriteria('ano','=',$ano);
		$criteria->addCriteria('tipoLancamento','=','1');//DOTAÇÃO INICIAL
		$criteria->addOrCriteria('tipoLancamento','=','8');//COMPLEMENTAÇÃO DE CRÉDITO
		$criteria->addOrderAttribute('idUoRequisitante');
		return $criteria->retrieveAsQuery();
	}
	
	function getDataDotacaoComplementacao($idUoReq)
	{
		$criteria = $this->getCriteria();
		$criteria->AddColumnAttribute('data');
		$criteria->addCriteria('idUoRequisitante','=',$idUoReq);		
		$criteria->addCriteria('tipoLancamento','=','1');//DOTAÇÃO INICIAL
		$criteria->addOrCriteria('tipoLancamento','=','8');//COMPLEMENTAÇÃO DE CRÉDITO
		$criteria->addOrderAttribute('idUoRequisitante');
		return $criteria->retrieveAsQuery();
	}

	function getSiglaByIduo($id)
	{
		global $MIOLO;
		$uo = $MIOLO->getBusiness('adm','uo');
		$criteria = $uo->getCriteria();
		$criteria->addColumnAttribute('sigla');
		$criteria->addCriteria('idUo','=', $id);		
		return $criteria->retrieveAsQuery();
	}
	
	function getUsuario($id)
	{
		$criteria = $this->getCriteria();
		$criteria->addColumnAttribute('usuario.pessoa.nome');
		$criteria->addCriteria('idLancamentoInt','=', $id);
		$query = $criteria->retrieveAsQuery();
		return $query->result[0][0];
	}
}
?>
