<?
/* Copyright 2006, 2007, 2008, 2009, 2010 do SETEC/MEC
 *
 * Este arquivo é parte do programa SigaEPT
 *
 * O SigaEPT é um software livre;  você pode redistribuí-lo e/ou modificá-lo dentro dos
 * termos da Licença Pública Geral GNU como publicada pela fundação do software livre (FSF);
 * na versão 2 da Licença.
 *
 * Este programa é distribuído na esperança que possa ser útil, mas SEM NENHUMA GARANTIA; sem
 * uma garantia implícita de ADEQUAÇÃO a qualquer MERCADO ou APLICAÇÃO EM PARTICULAR. Veja Licença
 * Pública Geral GNU/GPL em português para maiores detalhes.
 *
 * Você deve ter recebido uma cópia da Licença Pública Geral GNU, sob o título “LICENCA.txt”,
 * junto com este programa, se não, acesse o portal do Software Público Brasileiro no endereço
 * www.softwarepublico.gov.br ou escreva para Fundação do Software Livre (FSF) Inc.,51 Franklin
 * St, Fifth Floor, Boston, MA 02110-1301, USA
 */

class frmProadesPortariaExibir extends MForm
{
    private $proades;
    
	function __construct($proades)
	{
        $this->proades = $proades; 
        
		parent::__construct('Portaria');
		$this->EventHandler();
	}
    
	function CreateFields()
	{
        $proades = $this->proades;
        $meses = array(
                "01"=>"Janeiro",
                "02"=>"Fevereiro",
                "03"=>"Mar&ccedil;o",
                "04"=>"Abril",
                "05"=>"Maio",
                "06"=>"Junho",
                "07"=>"Julho",
                "08"=>"Agosto",
                "09"=>"Setembro",
                "10"=>"Outubro",
                "11"=>"Novembro",
                "12"=>"Dezembro"
            );
        $publicacao = $this->manager->getBusiness('rh','publicacao');
        $publicacao->getById($proades->idPublicacao);

        $data = explode("/",$publicacao->data);
        $mes = $meses[$data[1]];

        if ( $proades->mesPortariaDirigente < 10 )
        {
            $mesDirigente = $meses["0".$proades->mesPortariaDirigente];
        }
        else
        {
            $mesDirigente = $meses[$proades->mesPortariaDirigente];
        }

        $setor = $this->manager->getBusiness('common','setor');
        $setor->getById($proades->idSetor);

        $query = $proades->listMembrosEquipeCoordenacao();

        foreach ( $query->result as $rs )
        {
            if ( $rs[1] != $proades->idDirigente )
            {
                $txt .= $rs[2]."<br>";
            }
        }

        $fields = array(
            new MText("","MINISTERIO DA EDUCACAO <BR> UNIVERSIDADE FEDERAL DE JUIZ DE FORA <BR> <BR> PORTARIA NUMERO $publicacao->numero, de $data[0] de $mes de $data[2]. <BR> O Dirigente do(a) $setor->nome, no uso da compet&ecirc;ncia que lhe foi delegada atrav&eacute;s da Portaria no $proades->numeroPortariaDirigente, de $proades->diaPortariaDirigente de $mesDirigente de $proades->anoPortariaDirigente, <br> Resolve: <br> Designar os T&eacute;cnico-Administrativos em Educa&ccedil;&atilde;o abaixo relacionados para, sob sua coordena&ccedil;&atilde;o, comporem a Coordena&ccedil;&atilde;o Setorial de Avalia&ccedil;&atilde;o, desta Unidade, de acordo com o artigo 14, da Resolu&ccedil;&atilde;o no 08, de 27 de junho de 2007.   "),
            new MSeparator(),
            new MText("",$txt)

        ); 
        
        $this->SetFields($fields);		

        $buttons = array(
                new MButton('btnImprimir','Imprimir','pdf')
                );

        $this->setButtons($buttons);

	}

    function btnImprimir_click()
    {
        $proades = $this->proades;
        $meses = array(
                "01"=>"Janeiro",
                "02"=>"Fevereiro",
                "03"=>"Marco",
                "04"=>"Abril",
                "05"=>"Maio",
                "06"=>"Junho",
                "07"=>"Julho",
                "08"=>"Agosto",
                "09"=>"Setembro",
                "10"=>"Outubro",
                "11"=>"Novembro",
                "12"=>"Dezembro"
            );
        $publicacao = $this->manager->getBusiness('rh','publicacao');
        $publicacao->getById($proades->idPublicacao);

        $data = explode("/",$publicacao->data);
        $mes = $meses[$data[1]];

        if ( $proades->mesPortariaDirigente < 10 )
        {
            $mesDirigente = $meses["0".$proades->mesPortariaDirigente];
        }
        else
        {
            $mesDirigente = $meses[$proades->mesPortariaDirigente];
        }

        $setor = $this->manager->getBusiness('common','setor');
        $setor->getById($proades->idSetor);

        $query = $proades->listMembrosEquipeCoordenacao();


//      report
        $report = new MEzPDFReport('2','portrait');
        $report->pdf->ezSetCmMargins(8.5,2.5,3.5,2.5);
//      text report
        $report->pdf->ezText('UNIVERSIDADE FEDERAL DE JUIZ DE FORA',12);
        $report->pdf->ezText('PORTARIA INTERNA');
//      table report
        $options['textCol'] = array(0,0,0);
        $options['shaded'] = 0;
        $options['showLines'] = 0;
        $options['fontSize'] = 12;
        $options['maxWidth'] = 480;
        $options['xPos'] = 'left';
        $options['xOrientation'] = 'right';
        $cols = array('','');

        $dataRel[] = array("MINISTERIO DA EDUCACAO");
        $dataRel[] = array("UNIVERSIDADE FEDERAL DE JUIZ DE FORA");
        $dataRel[] = array(" PORTARIA NUMERO $publicacao->numero, de $data[0] de $mes de $data[2].");
        $dataRel[] = array("O Dirigente do(a) $setor->nome, no uso da competencia que lhe foi delegada atraves da Portaria no $proades->numeroPortariaDirigente, de $proades->diaPortariaDirigente de $mesDirigente de $proades->anoPortariaDirigente,");
        $dataRel[] = array("Resolve:");
        $dataRel[] = array("Designar os Tecnico-Administrativos em Educacao abaixo relacionados para, sob sua coordenacao, comporem a Coordenacao Setorial de Avaliacao, desta Unidade, de acordo com o artigo 14, da Resolucao no. 08, de 27 de junho de 2007.");
        foreach ( $query->result as $rs )
        {
            if ( $rs[1] != $proades->idDirigente )
            {
                $dataRel[] = array($rs[2]);
            }
        }
        $report->pdf->ezTable($dataRel,$cols,'',$options);
//      report
        $report->Execute();
    }
}
?>
