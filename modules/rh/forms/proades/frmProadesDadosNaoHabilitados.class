<?
/* Copyright 2006, 2007, 2008, 2009, 2010 do SETEC/MEC
 *
 * Este arquivo é parte do programa SigaEPT
 *
 * O SigaEPT é um software livre;  você pode redistribuí-lo e/ou modificá-lo dentro dos
 * termos da Licença Pública Geral GNU como publicada pela fundação do software livre (FSF);
 * na versão 2 da Licença.
 *
 * Este programa é distribuído na esperança que possa ser útil, mas SEM NENHUMA GARANTIA; sem
 * uma garantia implícita de ADEQUAÇÃO a qualquer MERCADO ou APLICAÇÃO EM PARTICULAR. Veja Licença
 * Pública Geral GNU/GPL em português para maiores detalhes.
 *
 * Você deve ter recebido uma cópia da Licença Pública Geral GNU, sob o título “LICENCA.txt”,
 * junto com este programa, se não, acesse o portal do Software Público Brasileiro no endereço
 * www.softwarepublico.gov.br ou escreva para Fundação do Software Livre (FSF) Inc.,51 Franklin
 * St, Fifth Floor, Boston, MA 02110-1301, USA
 */

class frmProadesDadosNaoHabilitados extends MForm
{
    private $proades;

	function __construct($proades)
	{
        $MIOLO = MIOLO::getInstance();
		$this->proades = $proades;
        $this->proades->getById($this->reuniao->idProades);
		parent::__construct('Relatorio Geral de Taes Nao Habilitados');
		$this->EventHandler();
	}
    
	function CreateFields()
	{
        $fields = array(
            new MText("","Relatorio Geral de Taes Nao Habilitados")

        ); 
        
        $this->SetFields($fields);		

        $buttons = array(
                new MButton('btnImprimir','Imprimir','pdf')
            );
        $this->setButtons($buttons);

		$this->SetShowPostButton(FALSE);
	}

    function btnImprimir_click()
    {
//      report
        $report = new MEzPDFReport('2','portrait');
        //$report->pdf->ezSetCmMargins(8.5,2.5,3.5,2.5);
//      text report
        $report->pdf->ezText('UNIVERSIDADE FEDERAL DE JUIZ DE FORA',8);
        $report->pdf->ezText('RELATORIO GERAL DE TAES NAO HABILITADOS',8);
        $report->pdf->ezText(' ',8);
//      table report
        $options['textCol'] = array(0,0,0);
        $options['shaded'] = 0;
        $options['showLines'] = 0;
        $options['fontSize'] = 8;
        $options['maxWidth'] = 480;
        $options['xPos'] = 'left';
        $options['xOrientation'] = 'right';
        $cols = array('','');
        $queryAll = $this->proades->listAll();
        foreach ( $queryAll->result as $rs )
        {
            $idProades = $rs[0];
            $proades = $this->manager->getBusiness('rh','proades');
            $proades->getById($idProades);
            $reuniao = $proades->getReuniaoByNum(4);
            $setor = $this->manager->getBusiness('common','setor');
            $setor->getById($proades->idSetor);

            $naoHabilitados = $proades->listNaoHabilitados();
            if ( ! $naoHabilitados->eof() )
            {
                $report->pdf->ezText("Unidade: $setor->nome",8);
                $dataRel[] = array('Nao habilitados:');
                foreach ( $naoHabilitados->result as $rs )
                {
                    $idVinculo = $rs[1];
                    $vinculo = $this->manager->getBusiness('rh','vinculo');
                    $vinculo->getById($idVinculo);
                    $vinculo->retrieveAssociation('provimentos');
                    $provimento = $vinculo->getProvimentoAtual();
                    $dados = $provimento->getDados();
                    //siape - nome - classe/nivel - justificativa
                    $dataRel[] = array($idVinculo.' - '.$rs[2].' - '.$dados[0].' / Nivel: '.$dados[1].' - Justificativa: '.$rs[3]);
                }
                $dataRel[] = array('');
                $report->pdf->ezTable($dataRel,$cols,'',$options);
                unset($dataRel);
            }
        }

//      report
        $report->Execute();
    }
}
?>
