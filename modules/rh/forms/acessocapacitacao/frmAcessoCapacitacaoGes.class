<?
class frmAcessoCapacitacaoGes extends Form
{

    function __construct()
    {
	global $MIOLO, $module;
    	parent::__construct('Gestores');
        $this->SetClose($MIOLO->GetActionURL($module,'main:capacitacao:acesso',$item));
        $this->EventHandler();
    }
    function CreateFields()
    {
		$fields = array(
			new LookupTextField('lkpUsuario','','Login'),
			new TextField('nome','','Nome',50),
			new MCalendarField('dataInicio','','Data Início',10),
			new MCalendarField('dataFim','','Data Fim',10),
			new HiddenField('idUsuario',''),
        );
		
        $this->SetFields($fields);
		
	   $this->SetFieldAttr('lkpUsuario','module','common');
	   $this->SetFieldAttr('lkpUsuario','item','usuario');
	   $this->SetFieldAttr('lkpUsuario','event','filler');
	   $this->SetFieldAttr('lkpUsuario','related','idUsuario,lkpUsuario,NULL,NULL,NULL,NULL,nome');
		
		$buttons = array(
        	new FormButton('btnSalvar', 'Incluir')
            );
		$this->SetButtons($buttons);
		$validators = array(
					new RequiredValidator('dataInicio'),
					new RequiredValidator('dataFim')
				);
		$this->SetValidators($validators);

    }
	
	public function btnSalvar_click()
	{
		global $MIOLO;

		$idUsuario = $this->GetFormValue('idUsuario');
		$data = $this->getData();
		$k = new MKrono();
		$dataInicio = $this->GetFormValue('dataInicio');
		$dataFim = $this->GetFormValue('dataFim');
		$idU = $this->getFormValue('idUsuario');
		if(! $idU)
		{
			$this->addError('Informe o usuário corretamente');
		}
		elseif ( $k->compareDate($dataInicio,">",$dataFim) )
		{
                	$this->addError("Data início não pode ser maior que a Data Fim.");
		}
		else
		{
			$objGestor = $MIOLO->GetBusiness('rh','gestorcapacitacao');
			$objGestor->setData($data);
			try
			{
				$objGestor->save();
				$objGestor->Log(OP_INS,"Novo gestor de capacitação");
                        	//$go = $MIOLO->GetActionURL($module,'main:jornada',$jornada->idJornada);
        	    		//$page->Redirect($go);
  
			}
			catch (Exception $e)
			{
				$this->addError($e->getMessage());
			}

			$this->SetFieldValue('lkpUsuario','');
			$this->SetFieldValue('nome','');
			$this->SetFieldValue('dataFim','');
			$this->SetFieldValue('dataInicio','');
		}
	}
 }
?>
