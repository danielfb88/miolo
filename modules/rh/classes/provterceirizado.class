<?php
/* Copyright 2006, 2007, 2008, 2009, 2010 do SETEC/MEC
 *
 * Este arquivo é parte do programa SigaEPT
 *
 * O SigaEPT é um software livre;  você pode redistribuí-lo e/ou modificá-lo dentro dos
 * termos da Licença Pública Geral GNU como publicada pela fundação do software livre (FSF);
 * na versão 2 da Licença.
 *
 * Este programa é distribuído na esperança que possa ser útil, mas SEM NENHUMA GARANTIA; sem
 * uma garantia implícita de ADEQUAÇÃO a qualquer MERCADO ou APLICAÇÃO EM PARTICULAR. Veja Licença
 * Pública Geral GNU/GPL em português para maiores detalhes.
 *
 * Você deve ter recebido uma cópia da Licença Pública Geral GNU, sob o título “LICENCA.txt”,
 * junto com este programa, se não, acesse o portal do Software Público Brasileiro no endereço
 * www.softwarepublico.gov.br ou escreva para Fundação do Software Livre (FSF) Inc.,51 Franklin
 * St, Fifth Floor, Boston, MA 02110-1301, USA
 */

class BusinessRhProvTerceirizado extends MBusiness
{
	public $idTerceirizado;
	public $dataInicio;
	public $dataFim;
	public $idLocalTerceirizado;
	public $idFuncaoTerceirizado;
	public $idJornada;
	public $idEscala;
	public $idOcorrenciaTerceirizado;
	public $idInstituicaoTerceirizado;
	public $idContrato;
	
	public $localTerceirizado;
	public $funcao;
	public $jornada;
	public $escala;
	public $ocorrencia;
	public $instituicao; 
	public $contrato;

	function __construct($data = null)
	{
		parent::__construct('sigaept', $data);
	}

	 function OnCreate($data)
    {
        if (empty($data))
        {
//            $this->initialize();
        }
        else
        {
            $this->GetById($data);
        }
    }

	function GetById($idTerceirizado,$dataInicio)
	{
		$this->idTerceirizado = $idTerceirizado;
		$this->dataInicio 	  = $dataInicio;
		$this->retrieve();
		return $this;
	}

    function setDataFim($dataFim)
    {
        $this->dataFim = $dataFim;
    }

    function setDataInicio($dataInicio)
    {
        $this->dataInicio = $dataInicio;
    }
    
    function setIdFuncao($idFuncao)
    {
        $this->idFuncaoTerceirizado = $idFuncao;
    }
    
    function setIdInstituicao($idInstituicao)
    {
        $this->idInstituicaoTerceirizado = $idInstituicao;
    }
    
    function setIdJornada($idJornada)
    {
        $this->idJornada = $idJornada;
    }
    
    function setIdEscala($idEscala)
    {
        $this->idEscala = $idEscala;
    }
    
    function setIdLocal($idLocal)
    {
        $this->idLocalTerceirizado = $idLocal;
    }
    
    function setIdOcorrencia($idOcorrencia)
    {
        $this->idOcorrenciaTerceirizado = $idOcorrencia;
    }
    
    function setIdContrato($idContrato)
    {
        $this->idContrato = $idContrato;
    }
        
    function clonaProvimento($objProvimento)
    {
		$this->idTerceirizado = $objProvimento->idTerceirizado;
		$this->dataInicio = $objProvimento->dataInicio;
		$this->dataFim = $objProvimento->dataFim;
		$this->idLocalTerceirizado = $objProvimento->idLocalTerceirizado;
		$this->idFuncaoTerceirizado = $objProvimento->idFuncaoTerceirizado;
		$this->idJornada = $objProvimento->idJornada;
		$this->idEscala = $objProvimento->idEscala;
		$this->idOcorrenciaTerceirizado = $objProvimento->idOcorrenciaTerceirizado;
		$this->idInstituicaoTerceirizado = $objProvimento->idInstituicaoTerceirizado;
		$this->idContrato = $objProvimento->idContrato;
		
		$this->localTerceirizado = $objProvimento->localTerceirizado;
		$this->funcao = $objProvimento->funcao;
		$this->jornada = $objProvimento->jornada;
		$this->escala = $objProvimento->escala;
		$this->ocorrencia = $objProvimento->ocorrencia;
		$this->instituicao = $objProvimento->instituicao;
		return($this);
		//var_dump($this);
    }
    
    function getUltimoProvimento($idTerceirizado)
    {
        $criteria = $this->getCriteria();
        $criteria->addCriteria('idTerceirizado','=',"'$idTerceirizado'");
        $criteria->addOrderAttribute('dataInicio',false);
        //$criteria->addOrderAttribute('dataInicio',false);
        $this->retrieveFromCriteria($criteria);
    }
	
	function isEscala()
	{
		if ($this->idEscala)
			return true;
	}
	
	function updateContrato($idContrato)
    {
        $this->idContrato = $idContrato;
        $this->save();
    }
	
    function finalizaUltimoProvimento($idTerceirizado, $idOcorrencia, $data, $id1=null, $id2=null, $id3=null, $id4=null, $id5=null, $id6=null)
    {
        $k = new Krono();
    	$dataInformada = $k->operation('-',$data,'1%D');
        $this->GetUltimoProvimento($idTerceirizado);
        if (is_null($this->dataFim));
        {
        	$this->dataFim = $dataInformada;
        	$this->save();
        }
    	switch ( $idOcorrencia )
    	{
    		case 2:
				$this->idOcorrenciaTerceirizado = $idOcorrencia;
				$this->idLocalTerceirizado = $id1;
				$this->dataInicio = $data;
				$this->dataFim = null;
		        $this->setPersistent(false);
				$this->save();
    		break;
    		case 3:
				$this->idOcorrenciaTerceirizado = $idOcorrencia;
				$this->idInstituicaoTerceirizado = $id1;
				$this->dataInicio = $data;
				$this->dataFim = null;
		        $this->setPersistent(false);
				$this->save();
    		break;
    		case 4:
				$this->idOcorrenciaTerceirizado = $idOcorrencia;
				$this->idJornada = $id1;
				$this->idEscala = $id2;
				$this->dataInicio = $data;
				$this->dataFim = null;
		        $this->setPersistent(false);
				$this->save();
    		break;
    		case 5:
				$this->idOcorrenciaTerceirizado = $idOcorrencia;
				$this->idFuncaoTerceirizado = $id1;
				$this->dataInicio = $data;
				$this->dataFim = null;
		        $this->setPersistent(false);
				$this->save();
    		break;
			case 6:    	
				$this->idOcorrenciaTerceirizado = $idOcorrencia;
				$this->dataInicio = $data;
				$this->dataFim = $data;
		        $this->setPersistent(false);
				$this->save();
			break;
			//MUDANCA MULTIPLA
			case 7:
				$this->idOcorrenciaTerceirizado = $idOcorrencia;
				$this->idJornada = $id1;
				$this->idEscala = $id6;
				$this->idFuncaoTerceirizado = $id2;
				$this->idLocalTerceirizado = $id3;
				$this->idInstituicaoTerceirizado = $id4;
				$this->idContrato = $id5;
				$this->dataInicio = $data;
				$this->dataFim = null;
		        $this->setPersistent(false);
				$this->save();
    		break;
			//CONTRATO
			case 8:    	
			    $this->idOcorrenciaTerceirizado = $idOcorrencia;
				$this->idContrato = $id1;
				$this->dataInicio = $data;
				$this->dataFim = null;
		        $this->setPersistent(false);
				$this->save();
			break;
		}
    }  	
}
?>
