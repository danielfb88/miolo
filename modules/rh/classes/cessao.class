<?php
/* Copyright 2006, 2007, 2008, 2009, 2010 do SETEC/MEC
 *
 * Este arquivo é parte do programa SigaEPT
 *
 * O SigaEPT é um software livre;  você pode redistribuí-lo e/ou modificá-lo dentro dos
 * termos da Licença Pública Geral GNU como publicada pela fundação do software livre (FSF);
 * na versão 2 da Licença.
 *
 * Este programa é distribuído na esperança que possa ser útil, mas SEM NENHUMA GARANTIA; sem
 * uma garantia implícita de ADEQUAÇÃO a qualquer MERCADO ou APLICAÇÃO EM PARTICULAR. Veja Licença
 * Pública Geral GNU/GPL em português para maiores detalhes.
 *
 * Você deve ter recebido uma cópia da Licença Pública Geral GNU, sob o título “LICENCA.txt”,
 * junto com este programa, se não, acesse o portal do Software Público Brasileiro no endereço
 * www.softwarepublico.gov.br ou escreva para Fundação do Software Livre (FSF) Inc.,51 Franklin
 * St, Fifth Floor, Boston, MA 02110-1301, USA
 */

class BusinessRhCessao extends MBusiness
{
    public $idVinculo;
    public $dataInicio;
    public $dataFim;
    public $obs;
    public $tipoOnus;
    public $tipoCessao;
    public $idPublicacao;
    public $idGrupoOcorrencia;
    public $idOcorrencia;
    public $tipoInstituicao;
    public $idInstituicao;
    public $vinculo;
    public $instituicao;
    public $ocorrencia;
    
    function __construct($data=null)
    {
        $this->krono = new MKrono();
        parent::__construct('sigaept',$data);
    }

    function listCessoes($date=null)
    {           
        if ( is_null($date) ) $date = date("d/m/Y");
        //$dataFim = $this->krono->operation('-',$date,'1%D');
        //$dataInicio = $this->krono->operation('+',$date,'1%D');
        //$nDataInicio = new InvertDate($dataInicio);
        //$nDataFinal = new InvertDate($dataFim);
        $nDate = new InvertDate($date);
        //$nDataFinal = new InvertDate($dataFim);
        //$nDataInicio = new InvertDate($dataInicio);
        $criteria = $this->getCriteria();
        $criteria->addColumnAttribute('idVinculo');
        $criteria->addColumnAttribute('vinculo.funcionario.pessoa.nome','nome');
       $criteria->addColumnAttribute('dataInicio','dataInicio');
        $criteria->addColumnAttribute('dataFim','dataFim');     
        $criteria->addColumnAttribute('tipoOnus');
        //$criteria->addColumnAttribute('tipoCessao');
        $criteria->addColumnAttribute('tabelaGeral.item2', 'tipoCessao');
        $criteria->addColumnAttribute('ocorrencia.descricao');
        $criteria->addColumnAttribute('idInstituicao','instituicao');
		//$criteria->addColumnAttribute('idPublicacao','numero');
        $criteria->addCriteria('dataInicio','<=',"'{$nDate->date}'");   
        $criteria->addCriteria('tabelaGeral.tabela','=',"'RH_TIPOCESSAO'");  
        $criteria->addCriteria('dataFim','>=',"'{$nDate->date}'");
        $criteria->addOrderAttribute('vinculo.funcionario.pessoa.nome');  
        return $criteria->retrieveAsQuery();                            
    }

    function listFuncionariosCedidos($dtReferencia)//,$dataFim)
    {
        $dtReferencia = new InvertDate($dtReferencia);
        //$dataFim = new InvertDate($dataFim);
        $criteria = $this->getCriteria();
        $criteria->addColumnAttribute('idVinculo');
        $criteria->addColumnAttribute('vinculo.funcionario.pessoa.nome','nome');
        $criteria->addColumnAttribute('dataInicio','dataInicio');
        $criteria->addColumnAttribute('dataFim','dataFim');     
        $criteria->addColumnAttribute('tipoOnus');
        $criteria->addColumnAttribute('tabelaGeral.item2', 'tipoCessao');
        $criteria->addColumnAttribute('ocorrencia.descricao');
        $criteria->addColumnAttribute('instituicao.nome', 'instituicao');
        $criteria->addCriteria('tabelaGeral.tabela','=',"'RH_TIPOCESSAO'");
        $criteria->addCriteria('dataInicio','<=',"'{$dtReferencia->date}'");   
        $cc = new CriteriaCondition();
        $cc->addCriteria  ($criteria->getCriteria('dataFim','>=',"'{$dtReferencia->date}'"));
        $cc->addOrCriteria($criteria->getCriteria('dataFim','is',"null"));
        $criteria->addCriteria($cc);
        $criteria->addOrderAttribute('vinculo.funcionario.pessoa.nome');  
        return $criteria->retrieveAsQuery();
    }

}


?>
