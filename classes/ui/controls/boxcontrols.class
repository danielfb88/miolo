<?php

/**
 *
 */
class MBoxTitle extends MDiv
{
    protected $icon;
    protected $close;
    protected $help;

    /**
     *
     */
    public function __construct( $cssClass, $caption, $close = '', $icon = '', $help = NULL )
    {
        parent::__construct( '', $cssClass );

        $this->close = $close;
        $this->icon  = $icon;
        $this->setCaption( $caption );
    }

    /**
     *
     */
    public function setIcon( $icon )
    {
        $this->icon = $icon;
    }

    /**
     *
     */
    public function setClose( $action )
    {
        $this->close = $action;
    }

    /**
     *
     */
    public function generateInner()
    {
        $title = str_replace( ' ', '&nbsp;', $this->caption ) . "&nbsp;&nbsp;";

        if ( $this->icon == '' )
        {
            $title = '&nbsp;&nbsp;' . $title;
            $icon  = NULL;
        }
        else
        {
            $icon = new MSpan( '', new MImage('', '', $this->icon ), 'icon' );
        }

        $caption = new MSpan( '', $title, 'caption' );
        $close   = '';

        if ( $this->close != '' )
        {
            $close = new MButtonClose( $this->close );
            $close->setClass('button'); 
        }

        $spacer = new MSpacer();

        if ( $this->getBoxClass() == '' )
        {
            $this->setBoxClass( 'm-box-title' );
        }

        $this->inner = array( $icon, $caption, $close );
    }
}


/**
 *
 */
class MBox extends MDiv
{
    public $boxTitle;
    protected $boxInner;

    /**
     *
     */
    public function __construct( $caption = NULL, $close = '', $icon = '', $help = '' )
    {
        parent::__construct();
        $this->setId($this->getUniqueId());

        if ( is_null( $caption ) )
        {
            $this->boxTitle = NULL;
        }
        else
        {
            $this->boxTitle = new MBoxTitle( 'boxTitle', $caption, $close, $icon, $help );
        }
        $this->setBoxClass('m-box-box');
    }

    /**
     *
     */
    public function setClose( $close )
    {
        if ( $this->boxTitle InstanceOf MBoxTitle )
        {
            $this->boxTitle->setClose( $close );
        }
    }

    /**
     *
     */
    public function setCaption( $caption )
    {
        if ( is_null( $caption ) )
        {
            $this->boxTitle = NULL;
        }
        elseif ( $this->boxTitle InstanceOf MBoxTitle )
        {
            $this->boxTitle->setCaption( $caption );
        }
    }

    /**
     *
     */
    public function generateInner()
    {
        $this->insertControl( $this->boxTitle );
        $class = $this->getBoxClass();

        $attributes = $this->getAttributes();

        $this->inner = new MDiv('', $this->getControls(), 'm-box-box' );
        $this->setBoxId($this->getId());
        $this->setBoxClass( str_replace( 'm-box-box', 'm-box-outer', $class ), false );
        $this->setBoxAttributes( $attributes );
    }
}
?>