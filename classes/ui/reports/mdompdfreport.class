<?php
class MDOMPDFReport extends MForm
{
    var $options;
    var $rawdata;
    var $slot;
    var $pdf;    // MDOMPDF object
    var $y;
    var $fontFamily;

    function __construct($orientation = 'portrait', $paper='a4')
    {  global $MIOLO, $state, $page;
		
       $this->SetPDF(new MDOMPDF($orientation,$paper));
       parent::__construct();
       $this->slot = array();
       $this->rawdata = NULL;
       $this->InitializeOptions();
       $this->SetWidth(100);
    }

    function setPaper($orientation = 'portrait', $paper='a4')
    {
        $this->pdf->dompdf->set_paper($paper, $orientation);
    }

    function InitializeOptions()
    {
        $this->options['showLines'] = 0;
        $this->options['showHeadings'] = 1;
        $this->options['showTableTitle'] = 1;
        $this->options['shaded'] = 1;
        $this->options['shadeCol'] = array(0.8,0.8,0.8);
        $this->options['shadeCol2'] = array(0.7,0.7,0.7);
        $this->options['fontSize'] = 10;
        $this->options['textCol'] = array(0,0,0);
        $this->options['titleFontSize'] = 14;
        $this->options['rowGap'] = 2;
        $this->options['colGap'] = 5;
        $this->options['lineCol'] = array(0,0,0);
        $this->options['xPos'] = 'center';
        $this->options['xOrientation'] = 'center';
        $this->options['width'] = 0;
        $this->options['maxWidth'] = 596;
        $this->options['minRowSpace'] = -100;
        $this->options['innerLineThickness'] = 1;
        $this->options['outerLineThickness'] = 1;
        $this->options['protectRows'] = 1;
    }
    
    function SetOption($option, $value)
    {
        $this->options[$option] = $value;
    }

    function SetPDF($pdf)
    {
        $this->pdf = $pdf;
    }
 
    function GetPDF()
    {
        return $this->pdf;
    }

    function SetWidth($width)
    {
        $this->SetOption('width',$width);
    }

    function Execute()
    {
        $this->pdf->Execute();
    }

    function GenerateFile($fileName, $params=NULL)
    {
        $html = file_get_contents($fileName);
        $this->pdf->setInput($html,$params);
        $this->pdf->execute();
    }

    function Generate()
    {
        $body = new MDiv('',$this->GenerateBody());
        if (!is_null($this->bgColor)) $body->AddStyle('backgroundColor',$this->bgColor);
        $this->box->SetControls(array($body, $footer));
        $id = $this->getId();
        $form = $body;
        if (!is_null($this->align)) $form->AddBoxStyle('text-align',$this->align);
        if (!is_null($this->fontFamily)) $form->AddBoxStyle('fontFamily',$this->fontFamily);
        $theme = $this->manager->getTheme();
        $theme->setContent($form);
        $theme->setLayout('DOMPdf'); 
        $this->page->generateMethod = 'generateDOMPdf';
        $html = $this->page->generate();
        $this->pdf->setInput($html);
        $this->pdf->execute();
    }
}
?>